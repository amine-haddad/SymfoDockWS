{% extends 'base.html.twig' %}

{% block title %}
    Wild Series - √âpisode {{ episode.number }}
{% endblock %}

{% block body %}
<div class="container-fluid d-flex flex-column min-vh-100">
    <div class="container mb-4">
        <div class="row pt-3 d-flex justify-content-center">
            <!-- Display program poster if available, else default image -->
            <div class="col-md-4 text-center">
                <div class="shadow-lg">
                    {% if program.poster is empty %}
                        <img src="{{ asset('images/the_walking_dead_saison_1.jpeg') | imagine_filter('poster_thumbnail') }}" class="img-fluid" alt="{{ program.title }}">
                    {% else %}
                    <img src="{{ vich_uploader_asset(program, 'posterFile') | imagine_filter('poster_thumbnail') }}" class=" img-fluid rounded" alt="{{ program.title }}">
                    {% endif %}
                </div>
            </div>
            <div class="col-md-8 d-flex flex-column align-items-center">
                <!-- Display program title, season number, episode number, and title -->
                <h1 class="m-3 text-center">{{ program.title }}</h1>
                <span class="m-2">Saison : {{ season.number }}</span>
                <h2 class="m-2 text-center">{{ episode.title }}</h2>
                <span>√âpisode : {{ episode.number }}</span>
                <p class="m-2 fst-italic text-center">Synopsis :</p>
                <p class="m-2 text-center">{{ episode.synopsis }}</p>
                <p class="m-2">{{ episode.duration }} min</p>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-6 d-flex justify-content-center mb-2">
                <!-- Display a link to return to the season page -->
                <a href="{{ path('program_season_show', { slug: program.slug, season_id: season.id }) }}" class="btn btn-outline-light">Back to Seasons</a>
                {% if is_granted("ROLE_ADMIN") %}
                    <a href="{{ path('program_edit', { 'slug': program.slug} ) }}" class="btn btn-outline-secondary">√âditer</a>
                {% endif %}
            </div>
            <div class="col-md-6 d-flex justify-content-center mb-2">
                <!-- Display a link to the video playback page -->
                <a href="{{ path('program_episode_show', { slug: program.slug, season_id: season.id, slugy: episode.slug }) }}" class="btn btn-primary">See Video</a>
            </div>
        </div>
        <div class="row mt-4 justify-content-center mb-2">
            <div class="col-6">
                {% for comment in comments|sort|reverse %}
                    <div class="mb-3">
                        <p>{{ comment.comment }}</p>
                        <p>{{ comment.author.email }}
                            {% if (is_granted("ROLE_ADMIN")) %}
                            {{ include('program/_delete_comment_form.html.twig', {'program': program, 'season': season, 'episode': episode, 'comment': comment}) }}                     
                            {% elseif (is_granted("ROLE_CONTRIBUTOR")) %}
                                
                            {% if comment.author == app.user  %}
                                {{ include('program/_delete_comment_form.html.twig', {'program': program, 'season': season, 'episode': episode, 'comment': comment}) }}
                            {% endif %}</p>
                        
                        {% endif %}
                            
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="container mt-4">
            {% if app.user is empty %}
                <p>Pour Ajouter un commentaire, connectez-vous!</p>
            {% else %}
                <p>Connect√© en temps que : {{ app.user.email }} üòä üëç</p>
                <!-- Form to submit a comment -->
                {{ form_start(form) }}
                <div class="mb-3">
                    {{ form_row(form.comment) }}
                </div>
                <div class="mb-3">
                    {{ form_row(form.rate) }}
                </div>
                <button class="btn btn-primary">{{ button_label|default('Add Comment') }}</button>
                {{ form_end(form) }}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
